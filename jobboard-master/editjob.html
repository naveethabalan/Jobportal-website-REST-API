
<!doctype html>
<html lang="en">
  <head>
    <title>JobBoard &mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    
    <link rel="stylesheet" href="css/custom-bs.css">
    <link rel="stylesheet" href="css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="css/bootstrap-select.min.css">
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="fonts/line-icons/style.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/quill.snow.css">
    <!-- Add these lines to include Quill's CSS and JavaScript -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    

<!-- Include Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Include Bootstrap DateTimePicker CSS and JS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

<!-- Other scripts -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<!-- Include your o
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/style.css">
    
  </head>
  <body id="top">

  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
    

<div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->
    

    <!-- NAVBAR -->
    <header class="site-navbar mt-3">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="site-logo col-6"><a href="index.html">JobBoard</a></div>

          <nav class="mx-auto site-navigation">
            <ul class="site-menu js-clone-nav d-none d-xl-block ml-0 pl-0">
              <li><a href="index.html" class="nav-link active">Home</a></li>
              <li><a href="Employer profile.html">Profile</a></li>
             <li><a href="post-job.html" class="active">post-job</a></li> 
              <li class="has-children">
                
                <ul class="dropdown">
                  <li><a href="job-single.html">Job Single</a></li>
                  <li><a href="post-job.html" class="active">Post a Job</a></li>
                </ul>
              </li>
              <li class="has-children">
                <a href="services.html">Pages</a>
                <ul class="dropdown">
                  <li><a href="services.html">Services</a></li>
                  <li><a href="service-single.html">Service Single</a></li>
                  <li><a href="blog-single.html">Blog Single</a></li>
                  <li><a href="portfolio.html">Portfolio</a></li>
                  <li><a href="portfolio-single.html">Portfolio Single</a></li>
                  <li><a href="testimonials.html">Testimonials</a></li>
                  <li><a href="faq.html">Frequently Ask Questions</a></li>
                  <li><a href="gallery.html">Gallery</a></li>
                </ul>
              </li>
              <li><a href="blog.html">Blog</a></li>
              <li><a href="contact.html">Contact</a></li>
              <li class="d-lg-none"><a href="post-job.html"><span class="mr-2">+</span> Post a Job</a></li>
              <li class="d-lg-none"><a href="login.html">Log In</a></li>
            </ul>
          </nav>
          
          <div class="right-cta-menu text-right d-flex aligin-items-center col-6">
            <div class="ml-auto">
              <a href="post-job.html" class="btn btn-outline-white border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-add"></span>Post a Job</a>
              <a href="login.html" class="btn btn-primary border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-lock_outline"></span>Log In</a>
            </div>
            <a href="#" class="site-menu-toggle js-menu-toggle d-inline-block d-xl-none mt-lg-2 ml-3"><span class="icon-menu h3 m-0 p-0 mt-2"></span></a>
          </div>

        </div>
      </div>
    </header>

    <!-- HOME -->
    <section class="section-hero overlay inner-page bg-image" style="background-image: url('images/hero_1.jpg');" id="home-section">
      <div class="container">
        <div class="row">
          <div class="col-md-7">
            <h1 class="text-white font-weight-bold">Edit  Job</h1>
            <div class="custom-breadcrumbs">
              <a href="#">Home</a> <span class="mx-2 slash">/</span>
              <a href="#">Job</a> <span class="mx-2 slash">/</span>
              <span class="text-white"><strong>Edit a Job</strong></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    
    <section class="site-section">
      <div class="container">

        <div class="d-flex align-items-center">
          <div>
         
          </div>
        </div>
          </div>
         
        <div class="row mb-5"  id="post">
          <div class="col-lg-12">
            <form class="p-4 p-md-5 border rounded" method="post">
              <h3 class="text-black mb-5 border-bottom pb-2">Job Details</h3>
              
              <div class="form-group">
                <label for="company-name">Company Name</label>
                <input type="text" class="form-control" id="company-name" placeholder="e.g. New York">
              </div>
             
              <div class="form-group">
                <label for="email">Email</label>
                <input type="text" class="form-control" id="email" placeholder="you@yourdomain.com">
              </div>
              <div class="form-group">
                <label for="job-title">Job Title</label>
                <input type="text" class="form-control" id="job-title" placeholder="Product Designer">
              </div>
              <div class="form-group">
                <label for="job-location">Address</label>
                <input type="text" class="form-control" id="job-address" placeholder="e.g. New York">
              </div>

              <!-- Job Industry Section -->
            
              <div class="form-group">
                <label for="job-industry">Job Industry</label>
                <select class="selectpicker border rounded" id="job-industry" data-style="btn-black" data-width="100%" data-live-search="true" title="Select Region">
                    <option value="Business">Business</option>
                    <option value="Information Technology"> IT</option>
                    <option value="Banking"> Banking</option>
                    <option value="Education/Training">Education</option>
                    <option value="Telecommunication">Telecommunication</option>
                    <option value="Others"> Others</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="job-type">Job Type</label>
                <select class="selectpicker border rounded" id="job-type" data-style="btn-black" data-width="100%" data-live-search="true" title="Select Job Type">
                    <option value="Part time">Part time</option>
                    <option value="Full time">Full time</option>
                    <option value="Internship">Internship</option>
                </select>
              </div>
              <div class="form-group">
                <label for="job-education">Education</label>
                <select class="selectpicker border rounded" id="job-education" data-style="btn-black" data-width="100%" data-live-search="true" title="Select Job Type">
                    <option value="Bachelors">Bachelors</option>
                    <option value="Masters"> Masters</option>
                    <option value="Phd">Phd</option>
                    <!-- <option value="Others">Others</option> -->
                </select>
              </div>
              <div class="form-group">
                <label for="job-experience">Experience</label>
                <select class="selectpicker border rounded" id="job-experience" data-style="btn-black" data-width="100%" data-live-search="true" title="Select Job Type">
                    <option value="No Experience">No Experience</option>
                    <option value="1 Years">1 Years</option>
                    <option value="2 Years">2 Years</option>
                    <option value="3 Years above">3 Years above</option>
                </select>
              

              <div class="form-group">
                <label for="job-salary">Salary</label>
                <input type="text" class="form-control" id="job-salary" placeholder="e.g. New York">
              </div>
              <div class="form-group">
                <label for="job-positions">Positions</label>
                <input type="text" class="form-control" id="job-positions" placeholder="Product Designer">
              </div>
             
            <div class="form-group">
              <label for="job-created-at">Created At</label>
              <input type="datetime-local" class="form-control" id="job-created-at" placeholder="YYYY-MM-DD">
            </div>
              <div class="form-group">
                <label for="job-created-at">Last Date</label>
                <input type="datetime-local" class="form-control" id="job-lastDate" placeholder="YYYY-MM-DD">
              </div>
              <div class="form-group">
                <label for="job-description">Job Description</label>
                <textarea class="form-control" id="job-description-textarea" placeholder="Write Job Description!"></textarea>
            </div>
              </div>
        
              </div>

            
              
              
          

            </form>
          </div>
         
         
        </div>
       
        <div class="row align-items-center mb-5">
          
          <div class="col-lg-4 ml-auto">
            <div class="row">
              <div class="col-6">
                <a href="#" class="btn btn-block btn-light btn-md"><span class="icon-open_in_new mr-2"></span>Preview</a>
              </div>
              <div class="col-6">
                <a href="#" class="btn btn-block btn-primary btn-md" id="update-button">Save Job</a>

            </div>
            
            </div>
          </div>
        </div>
      </div>
    </section>

    
    
    <footer class="site-footer">

      <a href="#top" class="smoothscroll scroll-top">
        <span class="icon-keyboard_arrow_up"></span>
      </a>

      <div class="container">
        <div class="row mb-5">
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Search Trending</h3>
            <ul class="list-unstyled">
              <li><a href="#">Web Design</a></li>
              <li><a href="#">Graphic Design</a></li>
              <li><a href="#">Web Developers</a></li>
              <li><a href="#">Python</a></li>
              <li><a href="#">HTML5</a></li>
              <li><a href="#">CSS3</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Company</h3>
            <ul class="list-unstyled">
              <li><a href="#">About Us</a></li>
              <li><a href="#">Career</a></li>
              <li><a href="#">Blog</a></li>
              <li><a href="#">Resources</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Support</h3>
            <ul class="list-unstyled">
              <li><a href="#">Support</a></li>
              <li><a href="#">Privacy</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Contact Us</h3>
            <div class="footer-social">
              <a href="#"><span class="icon-facebook"></span></a>
              <a href="#"><span class="icon-twitter"></span></a>
              <a href="#"><span class="icon-instagram"></span></a>
              <a href="#"><span class="icon-linkedin"></span></a>
            </div>
          </div>
        </div>

        <div class="row text-center">
          <div class="col-12">
            <p class="copyright"><small>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart text-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></small></p>
          </div>
        </div>
      </div>
    </footer>
  
  </div>



<script>

let urlParams;
let accessToken;

document.addEventListener("DOMContentLoaded", async function () {
    urlParams = new URLSearchParams(window.location.search);
    accessToken = localStorage.getItem('access_token');
    await getCurrentUser();  // Wait for getCurrentUser to complete before proceeding
    displayjobs();
});


async function getCurrentUser() {
    if (!accessToken) {
        console.error('Access token not found. User is not authenticated.');
        return Promise.reject('User not authenticated');
    }

    const jobId = urlParams && urlParams.get('id');
    console.log('Job ID:', jobId);

    try {
        const response = await fetch('http://127.0.0.1:8000/useraccount/current_user/', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json',
            },
        });

        if (!response.ok) {
            if (response.status === 401) {
                console.error('Unauthorized access. Token may be expired or invalid.');
                // You can choose to redirect the user to the login page or handle it differently
            } else {
                throw new Error(`Request failed with status ${response.status}`);
            }
        }

        const data = await response.json();
        console.log('Current User Data:', data, data.resume);
        console.log(localStorage);
        return data;
    } catch (error) {
        console.error('Error fetching current user data:', error);
        throw error;
    }
}



// ... (rest of the code remains unchanged)


function formatDateForInput(dateString) {
    const date = new Date(dateString);
    const formattedDate = date.toISOString().slice(0, 16);
    return formattedDate;
}

function displayjobs() {
    const id = urlParams && urlParams.get('id');

    console.log('Job ID:', id);

    if (id !== null) {
      const url = `http://127.0.0.1:8000/Jobid/${id}/`;


        fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
        })
        .then(response => {
            if (!response.ok) {
                console.error('Display failed');
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                return response.json();
            } else {
                return response.text();
            }
        })
        .then(data => {
            document.getElementById("company-name").value = data.company;
            document.getElementById("email").value = data.email;
            document.getElementById("job-title").value = data.title;
            document.getElementById("job-address").value = data.address;

            document.getElementById("job-industry").value = data.industry;
            document.getElementById("job-type").value = data.jobType;
            document.getElementById("job-education").value = data.education;
            document.getElementById("job-experience").value = data.experience;

            document.getElementById("job-salary").value = data.salary;
            document.getElementById("job-positions").value = data.positions;
            document.getElementById("job-created-at").value = formatDateForInput(data.createdAt);
            document.getElementById("job-lastDate").value = formatDateForInput(data.lastDate);
            document.getElementById("job-description-textarea").value = data.description;

            console.log(data);
        })
        .catch(error => {
            console.error('Error during job display:', error);
        });
    } else {
        console.error('Job ID is null. Cannot make API request.');
    }
}

window.onload = function () {
    displayjobs();
};

function updateJob(user) {
    console.log('UpdateJob function called');
    const accessToken = localStorage.getItem('access_token');
    const id = urlParams && urlParams.get('id');

    if (!accessToken) {
        console.error('Access token not found. User is not authenticated.');
        alert('User not authenticated');
        return Promise.reject('User not authenticated');
    }

    var title = document.getElementById("job-title").value;
    var description = document.getElementById("job-description-textarea").value;
    var email = document.getElementById("email").value;
    var address = document.getElementById("job-address").value;
    var jobType = document.getElementById("job-type").value;
    var education = document.getElementById("job-education").value;
    var industry = document.getElementById("job-industry").value;
    var experience = document.getElementById("job-experience").value;
    var salary = document.getElementById("job-salary").value;
    var positions = document.getElementById("job-positions").value;
    var company = document.getElementById("company-name").value;
    var lastDate = document.getElementById("job-lastDate").value;
    var createdAt = document.getElementById("job-created-at").value;

    var postData = {
        title: title,
        description: description,
        email: email,
        address: address,
        jobType: jobType,
        education: education,
        industry: industry,
        experience: experience,
        salary: salary,
        positions: positions,
        company: company,
        lastDate: lastDate,
        createdAt: createdAt,
        user: user && user.id,
    };

    const url = `http://127.0.0.1:8000/Jobid/${id}/`;

    return fetch(url, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`,
        },
        body: JSON.stringify(postData),
    })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Update failed with status ${response.status}`);
            }
            return response.json();
        })
        .then(updatedUserData => {
    console.log('Updated user data:', updatedUserData);

    // Check if the response contains expected data indicating success
    
        alert('Update successful');
    
})


        .catch(error => {
            console.error('Error during update:', error);
            alert('Update failed. Please try again.');
            if (error.response && error.response.text) {
                error.response.text().then(text => console.error('Full response:', text));
            }
        });
}

// Rest of your code...

document.getElementById('update-button').addEventListener('click', function (event) {
    console.log('Update button clicked');
    event.preventDefault();
    getCurrentUser();
    displayjobs();
    updateJob();
});


</script>
  
    <!-- SCRIPTS -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <!-- Include other scripts -->
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/stickyfill.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/quill.min.js"></script>
    <script src="js/bootstrap-select.min.js"></script>
    <script src="js/custom.js"></script>
    

   
     
  </body>
</html>