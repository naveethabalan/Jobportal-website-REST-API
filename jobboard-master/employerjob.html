
<!doctype html>
<html lang="en">
  <head>
    <title>JobBoard &mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    
    <link rel="stylesheet" href="css/custom-bs.css">
    <link rel="stylesheet" href="css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="css/bootstrap-select.min.css">
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="fonts/line-icons/style.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/quill.snow.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/style.css">    
  </head>
  <body id="top">

  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
    

<div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->
    

    <!-- NAVBAR -->
    <header class="site-navbar mt-3" style="margin-left: 100px;">
      <div class="container-fluid">
        <div class="row align-items-center">
        
          <nav class="mx-auto site-navigation">
            <ul class="site-menu js-clone-nav d-none d-xl-block ml-0 pl-0">
              <li><a href="index.html" class="nav-link">Home</a></li>
              <li><a href="Employer profile.html">Profile</a></li>
             
              <li><a href="post-job.html"><span class="mr-2">+</span> Post a Job</a></li>
              <li class="d-lg-none"><a href="login.html">Log In</a></li>
            </ul>
          </nav>
          
          <div class="right-cta-menu text-right d-flex aligin-items-center col-6">
            <div class="ml-auto">
              <a href="post-job.html" class="btn btn-outline-white border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-add"></span>Post a Job</a>
              <a href="login.html" class="btn btn-primary border-width-2 d-none d-lg-inline-block"><span class="mr-2 icon-lock_outline"></span>Log In</a>
            </div>
            <a href="#" class="site-menu-toggle js-menu-toggle d-inline-block d-xl-none mt-lg-2 ml-3"><span class="icon-menu h3 m-0 p-0 mt-2"></span></a>
          </div>

        </div>
      </div>
    </header>

    <!-- HOME -->
    <section class="section-hero overlay inner-page bg-image" style="background-image: url('images/hero_1.jpg');" id="home-section">
      <div class="container">
        <div class="row">
          <div class="col-md-7">
            <h1 class="text-white font-weight-bold">My Jobs</h1>
            <div class="custom-breadcrumbs">
              <a href="#">Home</a> <span class="mx-2 slash">/</span>
              <span class="text-white"><strong></strong></span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="site-section block__62272" id="next-section">
      <div class="container">
        <table class="table striped">
          <thead>
            <tr>
              <th> Job Id</th>
              <th> Job Name</th>
              <th>Salary</th>
              <th>Created at</th>
              <th>Last Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
             
              </td>
            </tr>
          </tbody>
        </table>
    
        <!-- Edit Modal -->
        <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
          <!-- Edit modal content -->
        </div>
    
        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
          <!-- Delete modal content -->
        </div>
      </div>
    </section>
    
    
    <footer class="site-footer">

      <a href="#top" class="smoothscroll scroll-top">
        <span class="icon-keyboard_arrow_up"></span>
      </a>

      <div class="container">
        <div class="row mb-5">
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Search Trending</h3>
            <ul class="list-unstyled">
              <li><a href="#">Web Design</a></li>
              <li><a href="#">Graphic Design</a></li>
              <li><a href="#">Web Developers</a></li>
              <li><a href="#">Python</a></li>
              <li><a href="#">HTML5</a></li>
              <li><a href="#">CSS3</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Company</h3>
            <ul class="list-unstyled">
              <li><a href="#">About Us</a></li>
              <li><a href="#">Career</a></li>
              <li><a href="#">Blog</a></li>
              <li><a href="#">Resources</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Support</h3>
            <ul class="list-unstyled">
              <li><a href="#">Support</a></li>
              <li><a href="#">Privacy</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="col-6 col-md-3 mb-4 mb-md-0">
            <h3>Contact Us</h3>
            <div class="footer-social">
              <a href="#"><span class="icon-facebook"></span></a>
              <a href="#"><span class="icon-twitter"></span></a>
              <a href="#"><span class="icon-instagram"></span></a>
              <a href="#"><span class="icon-linkedin"></span></a>
            </div>
          </div>
        </div>

        <div class="row text-center">
          <div class="col-12">
            <p class="copyright"><small>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart text-danger" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></small></p>
          </div>
        </div>
      </div>
    </footer>
  
  </div>


  <script>
function getCurrentUser() {
    // Get the access token from wherever you store it (localStorage, cookies, etc.)
    const accessToken = localStorage.getItem('access_token'); // Change this based on your token storage mechanism
    
    if (!accessToken) {
        // Handle the case where the access token is not available (user is not authenticated)
        console.error('Access token not found. User is not authenticated.');
        return Promise.reject('User not authenticated');
    }

    // Make a request to fetch the current user data
    return fetch('http://127.0.0.1:8000/useraccount/current_user/', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
        },
    })
    .then(response => {
        if (!response.ok) {
            if (response.status === 401) {
                // Handle unauthorized access (token may be expired or invalid)
                console.error('Unauthorized access. Token may be expired or invalid.');
                // You can choose to redirect the user to the login page or handle it differently
            } else {
                throw new Error(`Request failed with status ${response.status}`);
            }
        }
        return response.json();
    })
    .then(data => {
        // The server successfully returned the current user data
        console.log('Current User Data:', data, data.resume);
        return { user: data, accessToken }; // Return both user data and accessToken
    })
    .catch(error => {
        console.error('Error fetching current user data:', error);
        throw error; // Propagate the error for further handling if needed
    });
}

// Example usage:
getCurrentUser()
    .then(({ user, accessToken }) => {
        // Handle the current user data (e.g., update UI, etc.)
        getAppliedJobsForCurrentUser(user, accessToken);
    })
    .catch(error => {
        // Handle errors (e.g., redirect to login page, display an error message, etc.)
    });

    function JobsForCurrentUser(user, accessToken, callback) {
    // If user data is available, proceed with fetching applied jobs
    if (user && user.id) {
        fetch('http://127.0.0.1:8000/Job/currentuser/', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json',
            },
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(postedJobs => {
            // Handle the list of applied jobs (e.g., update UI)
            console.log('postedJobs:', postedJobs);
            // Assuming you want to do something with the applied jobs, update UI, etc.
            // You might want to call a function or perform other actions here
            handleAppliedJobs(postedJobs);
            
        })
        .catch(error => {
            console.error('Error fetching applied jobs:', error);
        });
    } else {
        console.error('User or user.id is undefined. Cannot fetch applied jobs.');
    }
}

// Example function to handle applied jobs




   // Example function to handle applied jobs
   function handleAppliedJobs(postedJobs) {
  const tableBody = document.querySelector('.table tbody');
  tableBody.innerHTML = ''; // Clear existing content

  postedJobs.forEach(job => {
    // Use template literals to dynamically generate HTML content for each row
    const rowHtml = `
      <tr>
        <td>${job.id}</td>
        <td>${job.title}</td>
        <td>${job.salary}</td>
        <td>${job.createdAt}</td>
        <td>${job.lastDate}</td>
        <td>
          <a href="editjob.html?id=${encodeURIComponent(job.id)}" class="btn btn-primary">
            Edit
          </a>
          <button class="btn btn-danger delete-button" data-job-id="${job.id}">
            Delete
          </button>
        </td>
      </tr>
    `;

    // Append the generated HTML content to the table body
    tableBody.innerHTML += rowHtml;
  });

  // Add event listeners to delete buttons after rendering the table
  addDeleteButtonListeners();
}

function addDeleteButtonListeners() {
  const deleteButtons = document.querySelectorAll('.delete-button');
  deleteButtons.forEach(button => {
    button.addEventListener('click', deleteJob);
  });
}

// Example usage:
getCurrentUser()
  .then(({ user, accessToken }) => {
    // Handle the current user data (e.g., update UI, etc.)
    JobsForCurrentUser(user, accessToken);
  })
  .catch(error => {
    // Handle errors (e.g., redirect to login page, display an error message, etc.)
  });

// Define the deleteJob function first
function deleteJob() {
  console.log('delete button clicked');

  // Placeholder for id, replace with actual id if needed
  const id = 20;  // Replace with the actual id

  // Make a DELETE request to the delete API
  fetch(`http://127.0.0.1:8000/Jobid/${id}/`, {
      method: 'DELETE',
  })
  .then(response => {
      if (!response.ok) {
          throw new Error(`Delete failed with status ${response.status}`);
      }
      return response.json();
  })
  .then(data => {
      console.log('Delete successful', data);
      // Handle any additional client-side actions (e.g., redirect, update UI, etc.)
  })
  .catch(error => {
      console.error('Error during delete:', error);
      alert('Delete failed');
  });
}

// Define the addDeleteButtonListeners function
function addDeleteButtonListeners() {
  const deleteButtons = document.querySelectorAll('.delete-button');
  deleteButtons.forEach(button => {
    button.addEventListener('click', deleteJob);
  });
}

// Rest of your code...

// Example usage:
getCurrentUser()
  .then(({ user, accessToken }) => {
    // Handle the current user data (e.g., update UI, etc.)
    JobsForCurrentUser(user, accessToken);
    // Call addDeleteButtonListeners after rendering the table
    addDeleteButtonListeners();
  })
  .catch(error => {
    // Handle errors (e.g., redirect to login page, display an error message, etc.)
  });


    </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- SCRIPTS -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/stickyfill.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/quill.min.js"></script>
    
    
    <script src="js/bootstrap-select.min.js"></script>
    
    <script src="js/custom.js"></script>
   
   
     
  </body>
</html>